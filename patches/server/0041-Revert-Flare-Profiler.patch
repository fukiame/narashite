From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: fukiame <fukiame@proton.me>
Date: Mon, 6 Nov 2023 12:50:51 +0700
Subject: [PATCH] Revert "Flare Profiler"

unused,

i have no moni, and i dont use pufferfish host either

diff --git a/build.gradle.kts b/build.gradle.kts
index 35ff6bf3cfa2327978e4c8465db35190e7b3b4d9..de1c73e9f4535e765c76a3c9dd34ded012318548 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -61,7 +61,6 @@ dependencies {
         exclude(group="org.yaml", module="snakeyaml")
     }
     // Pufferfish end
-    implementation("com.github.technove:Flare:34637f3f87") // Pufferfish - flare
 
     testImplementation("io.github.classgraph:classgraph:4.8.47") // Paper - mob goal test
     testImplementation("org.junit.jupiter:junit-jupiter:5.10.0")
diff --git a/src/main/java/gg/pufferfish/pufferfish/PufferfishConfig.java b/src/main/java/gg/pufferfish/pufferfish/PufferfishConfig.java
index 6755008dc43bf96c1507ce2ae6a066a1b75df760..cc66657cb4f978aa2df3ca1be6c683759952cc7a 100644
--- a/src/main/java/gg/pufferfish/pufferfish/PufferfishConfig.java
+++ b/src/main/java/gg/pufferfish/pufferfish/PufferfishConfig.java
@@ -15,7 +15,6 @@ import net.minecraft.world.entity.EntityType;
 import java.lang.reflect.Method;
 import java.lang.reflect.Modifier;
 import java.util.List;
-import gg.pufferfish.pufferfish.flare.FlareCommand;
 import net.minecraft.server.MinecraftServer;
 import org.apache.logging.log4j.Level;
 import org.bukkit.configuration.ConfigurationSection;
@@ -24,13 +23,6 @@ import org.jetbrains.annotations.Nullable;
 import org.simpleyaml.configuration.comments.CommentType;
 import org.simpleyaml.configuration.file.YamlFile;
 import org.simpleyaml.exceptions.InvalidConfigurationException;
-import org.bukkit.command.SimpleCommandMap;
-
-import java.lang.reflect.Method;
-import java.lang.reflect.Modifier;
-import java.util.List;
-import java.net.URI;
-import java.util.Collections;
 
 public class PufferfishConfig {
 	
@@ -290,30 +282,6 @@ public class PufferfishConfig {
 				"the ender dragon whenever a player places an end crystal.");
 	}
 
-    public static URI profileWebUrl;
-    private static void profilerOptions() {
-        profileWebUrl = URI.create(getString("flare.url", "https://flare.airplane.gg", "Sets the server to use for profiles."));
-
-        setComment("flare", "Configures Flare, the built-in profiler");
-    }
-
-
-    public static String accessToken;
-    private static void airplaneWebServices() {
-        accessToken = getString("web-services.token", "");
-        // todo lookup token (off-thread) and let users know if their token is valid
-        if (accessToken.length() > 0) {
-            gg.pufferfish.pufferfish.flare.FlareSetup.init(); // Pufferfish
-            SimpleCommandMap commandMap = MinecraftServer.getServer().server.getCommandMap();
-            if (commandMap.getCommand("flare") == null) {
-                commandMap.register("flare", "Pufferfish", new FlareCommand());
-            }
-        }
-
-        setComment("web-services", "Options for connecting to Pufferfish/Airplane's online utilities");
-
-    }
-
 
     public static boolean disableMethodProfiler;
 	public static boolean disableOutOfOrderChat;
diff --git a/src/main/java/gg/pufferfish/pufferfish/compat/ServerConfigurations.java b/src/main/java/gg/pufferfish/pufferfish/compat/ServerConfigurations.java
deleted file mode 100644
index 4ad189d52b27560424ddb311d0817a334637dc95..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/compat/ServerConfigurations.java
+++ /dev/null
@@ -1,78 +0,0 @@
-package gg.pufferfish.pufferfish.compat;
-
-import co.aikar.timings.TimingsManager;
-import com.google.common.io.Files;
-import org.bukkit.configuration.InvalidConfigurationException;
-import org.bukkit.configuration.file.YamlConfiguration;
-
-import java.io.ByteArrayOutputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.nio.charset.StandardCharsets;
-import java.util.Arrays;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.Properties;
-import java.util.stream.Collectors;
-
-public class ServerConfigurations {
-
-    public static final String[] configurationFiles = new String[]{
-      "server.properties",
-      "bukkit.yml",
-      "spigot.yml",
-      // "paper.yml", // TODO: Figure out what to do with this.
-      "pufferfish.yml"
-    };
-
-    public static Map<String, String> getCleanCopies() throws IOException {
-        Map<String, String> files = new HashMap<>(configurationFiles.length);
-        for (String file : configurationFiles) {
-            files.put(file, getCleanCopy(file));
-        }
-        return files;
-    }
-
-    public static String getCleanCopy(String configName) throws IOException {
-        File file = new File(configName);
-        List<String> hiddenConfigs = TimingsManager.hiddenConfigs;
-
-        switch (Files.getFileExtension(configName)) {
-            case "properties": {
-                Properties properties = new Properties();
-                try (FileInputStream inputStream = new FileInputStream(file)) {
-                    properties.load(inputStream);
-                }
-                for (String hiddenConfig : hiddenConfigs) {
-                    properties.remove(hiddenConfig);
-                }
-                ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
-                properties.store(outputStream, "");
-                return Arrays.stream(outputStream.toString()
-                  .split("\n"))
-                  .filter(line -> !line.startsWith("#"))
-                  .collect(Collectors.joining("\n"));
-            }
-            case "yml": {
-                YamlConfiguration configuration = new YamlConfiguration();
-                try {
-                    configuration.load(file);
-                } catch (InvalidConfigurationException e) {
-                    throw new IOException(e);
-                }
-                configuration.options().header(null);
-                for (String key : configuration.getKeys(true)) {
-                    if (hiddenConfigs.contains(key)) {
-                        configuration.set(key, null);
-                    }
-                }
-                return configuration.saveToString();
-            }
-            default:
-                throw new IllegalArgumentException("Bad file type " + configName);
-        }
-    }
-
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/CustomCategories.java b/src/main/java/gg/pufferfish/pufferfish/flare/CustomCategories.java
deleted file mode 100644
index 401b42e29bccb5251684062f10b2e0f8b091bc95..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/CustomCategories.java
+++ /dev/null
@@ -1,8 +0,0 @@
-package gg.pufferfish.pufferfish.flare;
-
-import co.technove.flare.live.category.GraphCategory;
-
-public class CustomCategories {
-    public static final GraphCategory MC_PERF = new GraphCategory("MC Performance");
-    public static final GraphCategory ENTITIES_AND_CHUNKS = new GraphCategory("Entities & Chunks");
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/FlareCommand.java b/src/main/java/gg/pufferfish/pufferfish/flare/FlareCommand.java
deleted file mode 100644
index 3785d1512eb650f91d58903672c059e7449598fc..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/FlareCommand.java
+++ /dev/null
@@ -1,136 +0,0 @@
-package gg.pufferfish.pufferfish.flare;
-
-import co.technove.flare.exceptions.UserReportableException;
-import co.technove.flare.internal.profiling.ProfileType;
-import gg.pufferfish.pufferfish.PufferfishConfig;
-import net.kyori.adventure.text.Component;
-import net.kyori.adventure.text.event.ClickEvent;
-import net.kyori.adventure.text.format.NamedTextColor;
-import net.kyori.adventure.text.format.TextColor;
-import net.kyori.adventure.text.format.TextDecoration;
-import net.minecraft.server.MinecraftServer;
-import org.apache.logging.log4j.Level;
-import org.bukkit.Bukkit;
-import org.bukkit.command.Command;
-import org.bukkit.command.CommandSender;
-import org.bukkit.command.ConsoleCommandSender;
-import org.bukkit.craftbukkit.scheduler.MinecraftInternalPlugin;
-import org.bukkit.util.StringUtil;
-import org.jetbrains.annotations.NotNull;
-
-import java.time.Duration;
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.List;
-
-public class FlareCommand extends Command {
-
-    private static final String BASE_URL = "https://blog.airplane.gg/flare-tutorial/#setting-the-access-token";
-    private static final TextColor HEX = TextColor.fromHexString("#e3eaea");
-    private static final Component PREFIX = Component.text()
-      .append(Component.text("Flare âœˆ")
-        .color(TextColor.fromHexString("#6a7eda"))
-        .decoration(TextDecoration.BOLD, true)
-        .append(Component.text(" ", HEX)
-          .decoration(TextDecoration.BOLD, false)))
-      .asComponent();
-
-    public FlareCommand() {
-        super("flare", "Profile your server with Flare", "/flare", Collections.singletonList("profile"));
-        this.setPermission("airplane.flare");
-    }
-
-    @Override
-    public boolean execute(@NotNull CommandSender sender, @NotNull String commandLabel, String @NotNull [] args) {
-        if (!testPermission(sender)) return true;
-        if (PufferfishConfig.accessToken.length() == 0) {
-            Component clickable = Component.text(BASE_URL, HEX, TextDecoration.UNDERLINED).clickEvent(ClickEvent.clickEvent(ClickEvent.Action.OPEN_URL, BASE_URL));
-
-            sender.sendMessage(PREFIX.append(Component.text("Flare currently requires an access token to use. To learn more, visit ").color(HEX).append(clickable)));
-            return true;
-        }
-
-        if (!FlareSetup.isSupported()) {
-            sender.sendMessage(PREFIX.append(
-              Component.text("Profiling is not supported in this environment, check your startup logs for the error.", NamedTextColor.RED)));
-            return true;
-        }
-        if (ProfilingManager.isProfiling()) {
-            if (args.length == 1 && args[0].equalsIgnoreCase("status")) {
-                sender.sendMessage(PREFIX.append(Component.text("Current profile has been ran for " + ProfilingManager.getTimeRan().toString(), HEX)));
-                return true;
-            }
-            if (ProfilingManager.stop()) {
-                if (!(sender instanceof ConsoleCommandSender)) {
-                    sender.sendMessage(PREFIX.append(Component.text("Profiling has been stopped.", HEX)));
-                }
-            } else {
-                sender.sendMessage(PREFIX.append(Component.text("Profiling has already been stopped.", HEX)));
-            }
-        } else {
-            ProfileType profileType = ProfileType.ITIMER;
-            if (args.length > 0) {
-                try {
-                    profileType = ProfileType.valueOf(args[0].toUpperCase());
-                } catch (Exception e) {
-                    sender.sendMessage(PREFIX.append(Component
-                      .text("Invalid profile type ", HEX)
-                      .append(Component.text(args[0], HEX, TextDecoration.BOLD)
-                        .append(Component.text("!", HEX)))
-                    ));
-                }
-            }
-            ProfileType finalProfileType = profileType;
-            Bukkit.getScheduler().runTaskAsynchronously(new MinecraftInternalPlugin(), () -> {
-                try {
-                    if (ProfilingManager.start(finalProfileType)) {
-                        if (!(sender instanceof ConsoleCommandSender)) {
-                            sender.sendMessage(PREFIX.append(Component
-                              .text("Flare has been started: " + ProfilingManager.getProfilingUri(), HEX)
-                              .clickEvent(ClickEvent.openUrl(ProfilingManager.getProfilingUri()))
-                            ));
-                            sender.sendMessage(PREFIX.append(Component.text("  Run /" + commandLabel + " to stop the Flare.", HEX)));
-                        }
-                    } else {
-                        sender.sendMessage(PREFIX.append(Component
-                          .text("Flare has already been started: " + ProfilingManager.getProfilingUri(), HEX)
-                          .clickEvent(ClickEvent.openUrl(ProfilingManager.getProfilingUri()))
-                        ));
-                    }
-                } catch (UserReportableException e) {
-                    sender.sendMessage(Component.text("Flare failed to start: " + e.getUserError(), NamedTextColor.RED));
-                    if (e.getCause() != null) {
-                        MinecraftServer.LOGGER.warn("Flare failed to start", e);
-                    }
-                }
-            });
-        }
-        return true;
-    }
-
-    @Override
-    public @NotNull List<String> tabComplete(@NotNull CommandSender sender, @NotNull String alias, String @NotNull [] args) throws IllegalArgumentException {
-        List<String> list = new ArrayList<>();
-        if (ProfilingManager.isProfiling()) {
-            if (args.length == 1) {
-                String lastWord = args[0];
-                if (StringUtil.startsWithIgnoreCase("status", lastWord)) {
-                    list.add("status");
-                }
-                if (StringUtil.startsWithIgnoreCase("stop", lastWord)) {
-                    list.add("stop");
-                }
-            }
-        } else {
-            if (args.length <= 1) {
-                String lastWord = args.length == 0 ? "" : args[0];
-                for (ProfileType value : ProfileType.values()) {
-                    if (StringUtil.startsWithIgnoreCase(value.getInternalName(), lastWord)) {
-                        list.add(value.name().toLowerCase());
-                    }
-                }
-            }
-        }
-        return list;
-    }
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/FlareSetup.java b/src/main/java/gg/pufferfish/pufferfish/flare/FlareSetup.java
deleted file mode 100644
index cd22e4dcc8b7b57b10a95ef084637249a98e524f..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/FlareSetup.java
+++ /dev/null
@@ -1,33 +0,0 @@
-package gg.pufferfish.pufferfish.flare;
-
-import co.technove.flare.FlareInitializer;
-import co.technove.flare.internal.profiling.InitializationException;
-import net.minecraft.server.MinecraftServer;
-import org.apache.logging.log4j.Level;
-
-public class FlareSetup {
-
-    private static boolean initialized = false;
-    private static boolean supported = false;
-
-    public static void init() {
-        if (initialized) {
-            return;
-        }
-
-        initialized = true;
-        try {
-            for (String warning : FlareInitializer.initialize()) {
-                MinecraftServer.LOGGER.warn("Flare warning: " + warning);
-            }
-            supported = true;
-        } catch (InitializationException e) {
-            MinecraftServer.LOGGER.warn("Failed to enable Flare:", e);
-        }
-    }
-
-    public static boolean isSupported() {
-        return supported;
-    }
-
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/PluginLookup.java b/src/main/java/gg/pufferfish/pufferfish/flare/PluginLookup.java
deleted file mode 100644
index 74aab5eb4b54ffbaf19b8976ffb8ca4a64584006..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/PluginLookup.java
+++ /dev/null
@@ -1,44 +0,0 @@
-package gg.pufferfish.pufferfish.flare;
-
-import com.google.common.cache.Cache;
-import com.google.common.cache.CacheBuilder;
-import org.bukkit.Bukkit;
-import org.bukkit.plugin.Plugin;
-import org.bukkit.plugin.java.PluginClassLoader;
-
-import java.util.Optional;
-import java.util.concurrent.TimeUnit;
-
-public class PluginLookup {
-    private static final Cache<String, String> pluginNameCache = CacheBuilder.newBuilder()
-      .expireAfterAccess(1, TimeUnit.MINUTES)
-      .maximumSize(1024)
-      .build();
-
-    public static Optional<String> getPluginForClass(String name) {
-        if (name.startsWith("net.minecraft") || name.startsWith("java.") || name.startsWith("com.mojang") ||
-          name.startsWith("com.google") || name.startsWith("it.unimi") || name.startsWith("sun")) {
-            return Optional.empty();
-        }
-
-        String existing = pluginNameCache.getIfPresent(name);
-        if (existing != null) {
-            return Optional.ofNullable(existing.isEmpty() ? null : existing);
-        }
-
-        String newValue = "";
-
-        for (Plugin plugin : Bukkit.getPluginManager().getPlugins()) {
-            ClassLoader classLoader = plugin.getClass().getClassLoader();
-            if (classLoader instanceof PluginClassLoader) {
-                if (((PluginClassLoader) classLoader)._airplane_hasClass(name)) {
-                    newValue = plugin.getName();
-                    break;
-                }
-            }
-        }
-
-        pluginNameCache.put(name, newValue);
-        return Optional.ofNullable(newValue.isEmpty() ? null : newValue);
-    }
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/ProfilingManager.java b/src/main/java/gg/pufferfish/pufferfish/flare/ProfilingManager.java
deleted file mode 100644
index e3f76eb11a261c3347f0cd89b5da309bc2dc82f9..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/ProfilingManager.java
+++ /dev/null
@@ -1,151 +0,0 @@
-package gg.pufferfish.pufferfish.flare;
-
-import co.technove.flare.Flare;
-import co.technove.flare.FlareAuth;
-import co.technove.flare.FlareBuilder;
-import co.technove.flare.exceptions.UserReportableException;
-import co.technove.flare.internal.profiling.ProfileType;
-import gg.pufferfish.pufferfish.PufferfishConfig;
-import gg.pufferfish.pufferfish.PufferfishLogger;
-import gg.pufferfish.pufferfish.compat.ServerConfigurations;
-import gg.pufferfish.pufferfish.flare.collectors.GCEventCollector;
-import gg.pufferfish.pufferfish.flare.collectors.StatCollector;
-import gg.pufferfish.pufferfish.flare.collectors.TPSCollector;
-import gg.pufferfish.pufferfish.flare.collectors.WorldCountCollector;
-import org.bukkit.Bukkit;
-import org.bukkit.craftbukkit.scheduler.MinecraftInternalPlugin;
-import org.bukkit.scheduler.BukkitTask;
-import oshi.SystemInfo;
-import oshi.hardware.CentralProcessor;
-import oshi.hardware.GlobalMemory;
-import oshi.hardware.HardwareAbstractionLayer;
-import oshi.hardware.VirtualMemory;
-import oshi.software.os.OperatingSystem;
-
-import java.io.IOException;
-import java.net.URI;
-import java.time.Duration;
-import java.util.Objects;
-import java.util.logging.Level;
-
-public class ProfilingManager {
-
-    private static Flare currentFlare;
-    private static BukkitTask currentTask = null;
-
-    public static synchronized boolean isProfiling() {
-        return currentFlare != null && currentFlare.isRunning();
-    }
-
-    public static synchronized String getProfilingUri() {
-        return Objects.requireNonNull(currentFlare).getURI().map(URI::toString).orElse("Flare is not running");
-    }
-
-    public static Duration getTimeRan() {
-        Flare flare = currentFlare; // copy reference so no need to sync
-        if (flare == null) {
-            return Duration.ofMillis(0);
-        }
-        return flare.getCurrentDuration();
-    }
-
-    public static synchronized boolean start(ProfileType profileType) throws UserReportableException {
-        if (currentFlare != null && !currentFlare.isRunning()) {
-            currentFlare = null; // errored out
-        }
-        if (isProfiling()) {
-            return false;
-        }
-        if (Bukkit.isPrimaryThread()) {
-            throw new UserReportableException("Profiles should be started off-thread");
-        }
-
-        try {
-            OperatingSystem os = new SystemInfo().getOperatingSystem();
-
-            SystemInfo systemInfo = new SystemInfo();
-            HardwareAbstractionLayer hardware = systemInfo.getHardware();
-
-            CentralProcessor processor = hardware.getProcessor();
-            CentralProcessor.ProcessorIdentifier processorIdentifier = processor.getProcessorIdentifier();
-
-            GlobalMemory memory = hardware.getMemory();
-            VirtualMemory virtualMemory = memory.getVirtualMemory();
-
-            FlareBuilder builder = new FlareBuilder()
-                    .withProfileType(profileType)
-                    .withMemoryProfiling(true)
-                    .withAuth(FlareAuth.fromTokenAndUrl(PufferfishConfig.accessToken, PufferfishConfig.profileWebUrl))
-
-                    .withFiles(ServerConfigurations.getCleanCopies())
-                    .withVersion("Primary Version", Bukkit.getVersion())
-                    .withVersion("Bukkit Version", Bukkit.getBukkitVersion())
-                    .withVersion("Minecraft Version", Bukkit.getMinecraftVersion())
-
-                    .withGraphCategories(CustomCategories.ENTITIES_AND_CHUNKS, CustomCategories.MC_PERF)
-                    .withCollectors(new TPSCollector(), new WorldCountCollector(), new GCEventCollector(), new StatCollector())
-                    .withClassIdentifier(PluginLookup::getPluginForClass)
-
-                    .withHardware(new FlareBuilder.HardwareBuilder()
-                            .setCoreCount(processor.getPhysicalProcessorCount())
-                            .setThreadCount(processor.getLogicalProcessorCount())
-                            .setCpuModel(processorIdentifier.getName())
-                            .setCpuFrequency(processor.getMaxFreq())
-
-                            .setTotalMemory(memory.getTotal())
-                            .setTotalSwap(virtualMemory.getSwapTotal())
-                            .setTotalVirtual(virtualMemory.getVirtualMax())
-                    )
-
-                    .withOperatingSystem(new FlareBuilder.OperatingSystemBuilder()
-                            .setManufacturer(os.getManufacturer())
-                            .setFamily(os.getFamily())
-                            .setVersion(os.getVersionInfo().toString())
-                            .setBitness(os.getBitness())
-                    );
-
-            currentFlare = builder.build();
-        } catch (IOException e) {
-            PufferfishLogger.LOGGER.log(Level.WARNING, "Failed to read configuration files:", e);
-            throw new UserReportableException("Failed to load configuration files, check logs for further details.");
-        }
-
-        try {
-            currentFlare.start();
-        } catch (IllegalStateException e) {
-            PufferfishLogger.LOGGER.log(Level.WARNING, "Error starting Flare:", e);
-            throw new UserReportableException("Failed to start Flare, check logs for further details.");
-        }
-
-        currentTask = Bukkit.getScheduler().runTaskLater(new MinecraftInternalPlugin(), ProfilingManager::stop, 20 * 60 * 15);
-        PufferfishLogger.LOGGER.log(Level.INFO, "Flare has been started: " + getProfilingUri());
-        return true;
-    }
-
-    public static synchronized boolean stop() {
-        if (!isProfiling()) {
-            return false;
-        }
-        if (!currentFlare.isRunning()) {
-            currentFlare = null;
-            return true;
-        }
-        PufferfishLogger.LOGGER.log(Level.INFO, "Flare has been stopped: " + getProfilingUri());
-        try {
-            currentFlare.stop();
-        } catch (IllegalStateException e) {
-            PufferfishLogger.LOGGER.log(Level.WARNING, "Error occurred stopping Flare", e);
-        }
-        currentFlare = null;
-
-        try {
-            currentTask.cancel();
-        } catch (Throwable t) {
-            PufferfishLogger.LOGGER.log(Level.WARNING, "Error occurred stopping Flare", t);
-        }
-
-        currentTask = null;
-        return true;
-    }
-
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/GCEventCollector.java b/src/main/java/gg/pufferfish/pufferfish/flare/collectors/GCEventCollector.java
deleted file mode 100644
index d426575c669020f369960107da1e2de2f11f082f..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/GCEventCollector.java
+++ /dev/null
@@ -1,66 +0,0 @@
-package gg.pufferfish.pufferfish.flare.collectors;
-
-import co.technove.flare.Flare;
-import co.technove.flare.internal.FlareInternal;
-import co.technove.flare.live.CollectorData;
-import co.technove.flare.live.EventCollector;
-import co.technove.flare.live.LiveEvent;
-import co.technove.flare.live.category.GraphCategory;
-import co.technove.flare.live.formatter.DataFormatter;
-import com.google.common.collect.ImmutableMap;
-import com.sun.management.GarbageCollectionNotificationInfo;
-
-import javax.management.ListenerNotFoundException;
-import javax.management.Notification;
-import javax.management.NotificationEmitter;
-import javax.management.NotificationListener;
-import javax.management.openmbean.CompositeData;
-import java.lang.management.GarbageCollectorMXBean;
-import java.lang.management.ManagementFactory;
-
-public class GCEventCollector extends EventCollector implements NotificationListener {
-
-    private static final CollectorData MINOR_GC = new CollectorData("builtin:gc:minor", "Minor GC", "A small pause in the program to allow Garbage Collection to run.", DataFormatter.MILLISECONDS, GraphCategory.SYSTEM);
-    private static final CollectorData MAJOR_GC = new CollectorData("builtin:gc:major", "Major GC", "A large pause in the program to allow Garbage Collection to run.", DataFormatter.MILLISECONDS, GraphCategory.SYSTEM);
-    private static final CollectorData UNKNOWN_GC = new CollectorData("builtin:gc:generic", "Major GC", "A run of the Garbage Collection.", DataFormatter.MILLISECONDS, GraphCategory.SYSTEM);
-
-    public GCEventCollector() {
-        super(MINOR_GC, MAJOR_GC, UNKNOWN_GC);
-    }
-
-    private static CollectorData fromString(String string) {
-        if (string.endsWith("minor GC")) {
-            return MINOR_GC;
-        } else if (string.endsWith("major GC")) {
-            return MAJOR_GC;
-        }
-        return UNKNOWN_GC;
-    }
-
-    @Override
-    public void start(Flare flare) {
-        for (GarbageCollectorMXBean garbageCollectorBean : ManagementFactory.getGarbageCollectorMXBeans()) {
-            NotificationEmitter notificationEmitter = (NotificationEmitter) garbageCollectorBean;
-            notificationEmitter.addNotificationListener(this, null, null);
-        }
-    }
-
-    @Override
-    public void stop(Flare flare) {
-        for (GarbageCollectorMXBean garbageCollectorBean : ManagementFactory.getGarbageCollectorMXBeans()) {
-            NotificationEmitter notificationEmitter = (NotificationEmitter) garbageCollectorBean;
-            try {
-                notificationEmitter.removeNotificationListener(this);
-            } catch (ListenerNotFoundException e) {
-            }
-        }
-    }
-
-    @Override
-    public void handleNotification(Notification notification, Object o) {
-        if (notification.getType().equals(GarbageCollectionNotificationInfo.GARBAGE_COLLECTION_NOTIFICATION)) {
-            GarbageCollectionNotificationInfo gcInfo = GarbageCollectionNotificationInfo.from((CompositeData) notification.getUserData());
-            reportEvent(new LiveEvent(fromString(gcInfo.getGcAction()), System.currentTimeMillis(), (int) gcInfo.getGcInfo().getDuration(), ImmutableMap.of()));
-        }
-    }
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/StatCollector.java b/src/main/java/gg/pufferfish/pufferfish/flare/collectors/StatCollector.java
deleted file mode 100644
index a22c6dbae53667e4c72464fa27153aee30c7946e..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/StatCollector.java
+++ /dev/null
@@ -1,41 +0,0 @@
-package gg.pufferfish.pufferfish.flare.collectors;
-
-import co.technove.flare.live.CollectorData;
-import co.technove.flare.live.LiveCollector;
-import co.technove.flare.live.category.GraphCategory;
-import co.technove.flare.live.formatter.DataFormatter;
-import com.sun.management.OperatingSystemMXBean;
-import oshi.SystemInfo;
-import oshi.hardware.CentralProcessor;
-
-import java.lang.management.ManagementFactory;
-import java.time.Duration;
-
-public class StatCollector extends LiveCollector {
-
-    private static final CollectorData CPU = new CollectorData("builtin:stat:cpu", "CPU Load", "The total amount of CPU usage across all cores.", DataFormatter.PERCENT, GraphCategory.SYSTEM);
-    private static final CollectorData CPU_PROCESS = new CollectorData("builtin:stat:cpu_process", "Process CPU", "The amount of CPU being used by this process.", DataFormatter.PERCENT, GraphCategory.SYSTEM);
-    private static final CollectorData MEMORY = new CollectorData("builtin:stat:memory_used", "Memory", "The amount of memory being used currently.", DataFormatter.BYTES, GraphCategory.SYSTEM);
-    private static final CollectorData MEMORY_TOTAL = new CollectorData("builtin:stat:memory_total", "Memory Total", "The total amount of memory allocated.", DataFormatter.BYTES, GraphCategory.SYSTEM);
-
-    private final OperatingSystemMXBean bean;
-    private final CentralProcessor processor;
-
-    public StatCollector() {
-        super(CPU, CPU_PROCESS, MEMORY, MEMORY_TOTAL);
-        this.interval = Duration.ofSeconds(5);
-
-        this.bean = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
-        this.processor = new SystemInfo().getHardware().getProcessor();
-    }
-
-    @Override
-    public void run() {
-        Runtime runtime = Runtime.getRuntime();
-
-        this.report(CPU, this.processor.getSystemLoadAverage(1)[0] / 100); // percentage
-        this.report(CPU_PROCESS, this.bean.getProcessCpuLoad());
-        this.report(MEMORY, runtime.totalMemory() - runtime.freeMemory());
-        this.report(MEMORY_TOTAL, runtime.totalMemory());
-    }
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/TPSCollector.java b/src/main/java/gg/pufferfish/pufferfish/flare/collectors/TPSCollector.java
deleted file mode 100644
index 40447d00aefb5ffedb8a2ee87155a04088f0649f..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/TPSCollector.java
+++ /dev/null
@@ -1,31 +0,0 @@
-package gg.pufferfish.pufferfish.flare.collectors;
-
-import co.technove.flare.live.CollectorData;
-import co.technove.flare.live.LiveCollector;
-import co.technove.flare.live.formatter.SuffixFormatter;
-import gg.pufferfish.pufferfish.flare.CustomCategories;
-import net.minecraft.server.MinecraftServer;
-import org.bukkit.Bukkit;
-
-import java.time.Duration;
-import java.util.Arrays;
-
-public class TPSCollector extends LiveCollector {
-    private static final CollectorData TPS = new CollectorData("airplane:tps", "TPS", "Ticks per second, or how fast the server updates. For a smooth server this should be a constant 20TPS.", SuffixFormatter.of("TPS"), CustomCategories.MC_PERF);
-    private static final CollectorData MSPT = new CollectorData("airplane:mspt", "MSPT", "Milliseconds per tick, which can show how well your server is performing. This value should always be under 50mspt.", SuffixFormatter.of("mspt"), CustomCategories.MC_PERF);
-
-    public TPSCollector() {
-        super(TPS, MSPT);
-
-        this.interval = Duration.ofSeconds(5);
-    }
-
-    @Override
-    public void run() {
-        long[] times = MinecraftServer.getServer().tickTimes5s.getTimes();
-        double mspt = ((double) Arrays.stream(times).sum() / (double) times.length) * 1.0E-6D;
-
-        this.report(TPS, Math.min(20D, Math.round(Bukkit.getServer().getTPS()[0] * 100d) / 100d));
-        this.report(MSPT, (double) Math.round(mspt * 100d) / 100d);
-    }
-}
diff --git a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/WorldCountCollector.java b/src/main/java/gg/pufferfish/pufferfish/flare/collectors/WorldCountCollector.java
deleted file mode 100644
index 029d840e28d67d26d3c0dd6785e25dbf15f9226c..0000000000000000000000000000000000000000
--- a/src/main/java/gg/pufferfish/pufferfish/flare/collectors/WorldCountCollector.java
+++ /dev/null
@@ -1,45 +0,0 @@
-package gg.pufferfish.pufferfish.flare.collectors;
-
-import co.technove.flare.live.CollectorData;
-import co.technove.flare.live.LiveCollector;
-import co.technove.flare.live.formatter.SuffixFormatter;
-import gg.pufferfish.pufferfish.flare.CustomCategories;
-import org.bukkit.Bukkit;
-import org.bukkit.World;
-
-import java.time.Duration;
-
-public class WorldCountCollector extends LiveCollector {
-
-    private static final CollectorData PLAYER_COUNT = new CollectorData("airplane:world:playercount", "Player Count", "The number of players currently on the server.", new SuffixFormatter(" Player", " Players"), CustomCategories.ENTITIES_AND_CHUNKS);
-    private static final CollectorData ENTITY_COUNT = new CollectorData("airplane:world:entitycount", "Entity Count", "The number of entities in all worlds", new SuffixFormatter(" Entity", " Entities"), CustomCategories.ENTITIES_AND_CHUNKS);
-    private static final CollectorData CHUNK_COUNT = new CollectorData("airplane:world:chunkcount", "Chunk Count", "The number of chunks currently loaded.", new SuffixFormatter(" Chunk", " Chunks"), CustomCategories.ENTITIES_AND_CHUNKS);
-    private static final CollectorData TILE_ENTITY_COUNT = new CollectorData("airplane:world:blockentitycount", "Block Entity Count", "The number of block entities currently loaded.", new SuffixFormatter(" Block Entity", " Block Entities"), CustomCategories.ENTITIES_AND_CHUNKS);
-
-    public WorldCountCollector() {
-        super(PLAYER_COUNT, ENTITY_COUNT, CHUNK_COUNT, TILE_ENTITY_COUNT);
-
-        this.interval = Duration.ofSeconds(5);
-    }
-
-    @Override
-    public void run() {
-        if (true) return; // This doesn't work, and it's not worth fixing at the moment.
-        int entities = 0;
-        int chunkCount = 0;
-        int tileEntityCount = 0;
-
-        if (!Bukkit.isStopping()) {
-            for (World world : Bukkit.getWorlds()) {
-                world.getEntityCount();
-                chunkCount += world.getChunkCount();
-                tileEntityCount += world.getTileEntityCount();
-            }
-        }
-
-        this.report(PLAYER_COUNT, Bukkit.getOnlinePlayers().size());
-        this.report(ENTITY_COUNT, entities);
-        this.report(CHUNK_COUNT, chunkCount);
-        this.report(TILE_ENTITY_COUNT, tileEntityCount);
-    }
-}
diff --git a/src/main/java/org/bukkit/craftbukkit/scheduler/MinecraftInternalPlugin.java b/src/main/java/org/bukkit/craftbukkit/scheduler/MinecraftInternalPlugin.java
index eb19f679ee498e51d02fe9a961cf02699cf75848..d96399e9bf1a58db5a4a22e58abb99e7660e0694 100644
--- a/src/main/java/org/bukkit/craftbukkit/scheduler/MinecraftInternalPlugin.java
+++ b/src/main/java/org/bukkit/craftbukkit/scheduler/MinecraftInternalPlugin.java
@@ -22,8 +22,7 @@ public class MinecraftInternalPlugin extends PluginBase {
     private boolean enabled = true;
 
     private final String pluginName;
-    private org.bukkit.plugin.PluginLogger logger;
-    private PluginDescriptionFile pdf; // Pufferfish
+    private PluginDescriptionFile pdf;
 
     public MinecraftInternalPlugin() {
         this.pluginName = "Minecraft";
@@ -82,12 +81,7 @@ public class MinecraftInternalPlugin extends PluginBase {
 
     @Override
     public PluginLogger getLogger() {
-        // Pufferfish start
-        if (this.logger == null) {
-            this.logger = new org.bukkit.plugin.PluginLogger(this); // Pufferfish
-        }
-        return this.logger;
-        // Pufferfish end
+        throw new UnsupportedOperationException("Not supported.");
     }
 
     @Override
@@ -97,7 +91,7 @@ public class MinecraftInternalPlugin extends PluginBase {
 
     @Override
     public Server getServer() {
-        return org.bukkit.Bukkit.getServer(); // Pufferfish - impl
+        throw new UnsupportedOperationException("Not supported.");
     }
 
     @Override
diff --git a/src/main/java/org/bukkit/craftbukkit/util/ServerShutdownThread.java b/src/main/java/org/bukkit/craftbukkit/util/ServerShutdownThread.java
index 3dff02fd97f001508e2f81192817bf1b0ef92446..e8e93538dfd71de86515d9405f728db1631e949a 100644
--- a/src/main/java/org/bukkit/craftbukkit/util/ServerShutdownThread.java
+++ b/src/main/java/org/bukkit/craftbukkit/util/ServerShutdownThread.java
@@ -11,7 +11,6 @@ public class ServerShutdownThread extends Thread {
 
     @Override
     public void run() {
-        try { gg.pufferfish.pufferfish.flare.ProfilingManager.stop(); } catch (Throwable t) {} // Pufferfish - shut down Flare if it's running
         try {
             // Paper start - try to shutdown on main
             server.safeShutdown(false, false);
